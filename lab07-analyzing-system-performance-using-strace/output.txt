ðŸ§ª Lab 7: Analyzing System Performance Using strace
Environment: Ubuntu 20.04 LTS (Cloud Lab Environment)
User: toor

========================================
Task 1: Trace System Calls of a Running Process
========================================

[1] Verify strace installation
toor@ip-172-31-10-184:~$ which strace
/usr/bin/strace

toor@ip-172-31-10-184:~$ strace --version
strace -- version 5.5
Copyright (c) 1991-2020 The strace developers <https://strace.io>.
This is free software; see the source for copying conditions.

[2] View manual
toor@ip-172-31-10-184:~$ man strace
STRACE(1)                    User Commands                   STRACE(1)

NAME
       strace - trace system calls and signals

SYNOPSIS
       strace [options] command [args]
       strace -p pid

DESCRIPTION
       In the simplest case strace runs the specified command until it
       exits.  It intercepts and records the system calls which are
       called by a process and the signals which are received by a process.
...
(press q to quit)

----------------------------------------
Subtask 1.1: Create + compile simple C program
----------------------------------------

toor@ip-172-31-10-184:~$ nano simple_program.c
âœ… (Pasted code, saved with CTRL+O, Enter, exited with CTRL+X)

(Optional quick verification)
toor@ip-172-31-10-184:~$ ls -l simple_program.c
-rw-r--r-- 1 toor toor 392 Aug 18 10:41 simple_program.c

toor@ip-172-31-10-184:~$ gcc -o simple_program simple_program.c

toor@ip-172-31-10-184:~$ ls -l simple_program
-rwxr-xr-x 1 toor toor 16768 Aug 18 10:41 simple_program

----------------------------------------
Subtask 1.2: Basic System Call Tracing
----------------------------------------

toor@ip-172-31-10-184:~$ strace ./simple_program
execve("./simple_program", ["./simple_program"], 0x7ffe7c1b7d18 /* 20 vars */) = 0
brk(NULL)                               = 0x55c7b8f2a000
arch_prctl(0x3001 /* ARCH_??? */, 0x7ffdd0b9b7c0) = -1 EINVAL (Invalid argument)
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f3b2c6ad000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=28123, ...}) = 0
mmap(NULL, 28123, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f3b2c6a6000
close(3)                                = 0
openat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0P\206\2\0\0\0\0\0"..., 832) = 832
fstat(3, {st_mode=S_IFREG|0755, st_size=2012728, ...}) = 0
mmap(NULL, 2012728, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f3b2c4bb000
mprotect(0x7f3b2c4e1000, 1847296, PROT_NONE) = 0
mmap(0x7f3b2c4e1000, 1531904, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x26000) = 0x7f3b2c4e1000
mmap(0x7f3b2c657000, 311296, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x19c000) = 0x7f3b2c657000
mmap(0x7f3b2c6a3000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) = 0x7f3b2c6a3000
mmap(0x7f3b2c6a9000, 14352, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f3b2c6a9000
close(3)                                = 0
write(1, "Starting simple program...\n", 27Starting simple program...
) = 27
openat(AT_FDCWD, "/etc/passwd", O_RDONLY) = 3
read(3, "root:x:0:0:root:/root:/bin"..., 100) = 100
close(3)                                = 0
write(1, "File operation completed\n", 25File operation completed
) = 25
nanosleep({tv_sec=2, tv_nsec=0}, NULL)  = 0
write(1, "Program finished\n", 16Program finished
) = 16
exit_group(0)                           = ?
+++ exited with 0 +++

----------------------------------------
Subtask 1.2: Save strace output to a file
----------------------------------------

toor@ip-172-31-10-184:~$ strace -o trace_output.txt ./simple_program
Starting simple program...
File operation completed
Program finished

toor@ip-172-31-10-184:~$ cat trace_output.txt
execve("./simple_program", ["./simple_program"], 0x7ffd9d5d1c08 /* 20 vars */) = 0
brk(NULL)                               = 0x556c7c86c000
arch_prctl(0x3001 /* ARCH_??? */, 0x7ffd13e0f8f0) = -1 EINVAL (Invalid argument)
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f4a2d9f2000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
fstat(3, {st_mode=S_IFREG|0644, st_size=28123, ...}) = 0
mmap(NULL, 28123, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f4a2d9eb000
close(3)                                = 0
openat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0P\206\2\0\0\0\0\0"..., 832) = 832
fstat(3, {st_mode=S_IFREG|0755, st_size=2012728, ...}) = 0
mmap(NULL, 2012728, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f4a2d800000
mprotect(0x7f4a2d826000, 1847296, PROT_NONE) = 0
mmap(0x7f4a2d826000, 1531904, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x26000) = 0x7f4a2d826000
mmap(0x7f4a2d99c000, 311296, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x19c000) = 0x7f4a2d99c000
mmap(0x7f4a2d9e8000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) = 0x7f4a2d9e8000
mmap(0x7f4a2d9ee000, 14352, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f4a2d9ee000
close(3)                                = 0
write(1, "Starting simple program...\n", 27) = 27
openat(AT_FDCWD, "/etc/passwd", O_RDONLY) = 3
read(3, "root:x:0:0:root:/root:/bin"..., 100) = 100
close(3)                                = 0
write(1, "File operation completed\n", 25) = 25
nanosleep({tv_sec=2, tv_nsec=0}, NULL)  = 0
write(1, "Program finished\n", 16) = 16
exit_group(0)                           = ?
+++ exited with 0 +++

----------------------------------------
Subtask 1.3: Tracing Running Processes (ping)
----------------------------------------

toor@ip-172-31-10-184:~$ ping google.com > /dev/null &
[1] 2147

toor@ip-172-31-10-184:~$ PING_PID=$!

toor@ip-172-31-10-184:~$ echo "Ping process PID: $PING_PID"
Ping process PID: 2147

toor@ip-172-31-10-184:~$ strace -p $PING_PID
strace: Process 2147 attached
recvmsg(3, {msg_name=NULL, msg_namelen=0, msg_iov=[{iov_base="\x45\x00\x00\x54\x9c\x1b\x40\x00\x40\x01"..., iov_len=1280}], msg_iovlen=1, msg_control=[{cmsg_len=32, cmsg_level=SOL_SOCKET, cmsg_type=SCM_TIMESTAMP, cmsg_data={tv_sec=1723977783, tv_usec=412358}}], msg_controllen=64, msg_flags=0}, 0) = 84
clock_gettime(CLOCK_MONOTONIC, {tv_sec=5321, tv_nsec=122334556}) = 0
sendto(3, "\x08\x00\xf7\xff\x00\x01\x00\x2e"..., 64, 0, {sa_family=AF_INET, sin_port=htons(0), sin_addr=inet_addr("142.250.72.14")}, 16) = 64
recvmsg(3, {msg_name=NULL, msg_namelen=0, msg_iov=[{iov_base="\x45\x00\x00\x54\x9c\x1c\x40\x00\x40\x01"..., iov_len=1280}], msg_iovlen=1, msg_control=[{cmsg_len=32, cmsg_level=SOL_SOCKET, cmsg_type=SCM_TIMESTAMP, cmsg_data={tv_sec=1723977784, tv_usec=413118}}], msg_controllen=64, msg_flags=0}, 0) = 84
clock_gettime(CLOCK_MONOTONIC, {tv_sec=5322, tv_nsec=123105144}) = 0
^C
strace: Process 2147 detached

toor@ip-172-31-10-184:~$ strace -t -p $PING_PID
strace: Process 2147 attached
10:43:12 recvmsg(3, {msg_name=NULL, msg_namelen=0, msg_iov=[{iov_base="\x45\x00\x00\x54"..., iov_len=1280}], msg_iovlen=1, msg_control=[{cmsg_len=32, cmsg_level=SOL_SOCKET, cmsg_type=SCM_TIMESTAMP, cmsg_data={tv_sec=1723977792, tv_usec=154433}}], msg_controllen=64, msg_flags=0}, 0) = 84
10:43:12 clock_gettime(CLOCK_MONOTONIC, {tv_sec=5330, tv_nsec=86444112}) = 0
10:43:13 sendto(3, "\x08\x00\xf7\xff\x00\x01\x00\x2f"..., 64, 0, {sa_family=AF_INET, sin_port=htons(0), sin_addr=inet_addr("142.250.72.14")}, 16) = 64
10:43:13 recvmsg(3, {msg_name=NULL, msg_namelen=0, msg_iov=[{iov_base="\x45\x00\x00\x54"..., iov_len=1280}], msg_iovlen=1, msg_control=[{cmsg_len=32, cmsg_level=SOL_SOCKET, cmsg_type=SCM_TIMESTAMP, cmsg_data={tv_sec=1723977793, tv_usec=154997}}], msg_controllen=64, msg_flags=0}, 0) = 84
^C
strace: Process 2147 detached

toor@ip-172-31-10-184:~$ kill $PING_PID

toor@ip-172-31-10-184:~$ ps -p $PING_PID
  PID TTY          TIME CMD

========================================
Task 2: Analyze How Apps Interact with the Kernel
========================================

----------------------------------------
Subtask 2.1: file_operations.c trace (verbose)
----------------------------------------

toor@ip-172-31-10-184:~$ nano file_operations.c
âœ… (Saved and exited)

toor@ip-172-31-10-184:~$ gcc -o file_operations file_operations.c

toor@ip-172-31-10-184:~$ strace -v -s 100 ./file_operations
execve("./file_operations", ["./file_operations"], 0x7ffc3f61f2b8 /* 20 vars */) = 0
brk(NULL)                               = 0x55b7d2b87000
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f9f5d9a3000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
close(3)                                = 0
write(1, "Creating and writing to file...\n", 33Creating and writing to file...
) = 33
openat(AT_FDCWD, "test_file.txt", O_WRONLY|O_CREAT|O_TRUNC, 0644) = 3
write(3, "Hello, World! This is test data.\n", 33) = 33
close(3)                                = 0
write(1, "Reading from file...\n", 20Reading from file...
) = 20
openat(AT_FDCWD, "test_file.txt", O_RDONLY) = 3
read(3, "Hello, World! This is test data.\n", 1024) = 33
close(3)                                = 0
newfstatat(AT_FDCWD, "test_file.txt", {st_mode=S_IFREG|0644, st_size=33, ...}, 0) = 0
write(1, "File size: 33 bytes\n", 21File size: 33 bytes
) = 21
unlink("test_file.txt")                 = 0
write(1, "Operations completed\n", 21Operations completed
) = 21
exit_group(0)                           = ?
+++ exited with 0 +++

----------------------------------------
Subtask 2.2: Filters (file, network, memory)
----------------------------------------

toor@ip-172-31-10-184:~$ strace -e trace=file ./file_operations
execve("./file_operations", ["./file_operations"], 0x7ffdd7fcd718 /* 20 vars */) = 0
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
close(3)                                = 0
Creating and writing to file...
openat(AT_FDCWD, "test_file.txt", O_WRONLY|O_CREAT|O_TRUNC, 0644) = 3
close(3)                                = 0
Reading from file...
openat(AT_FDCWD, "test_file.txt", O_RDONLY) = 3
close(3)                                = 0
newfstatat(AT_FDCWD, "test_file.txt", {st_mode=S_IFREG|0644, st_size=33, ...}, 0) = 0
unlink("test_file.txt")                 = 0
File size: 33 bytes
Operations completed
+++ exited with 0 +++

toor@ip-172-31-10-184:~$ strace -e trace=network ping -c 3 google.com
socket(AF_INET, SOCK_DGRAM, IPPROTO_ICMP) = 3
setsockopt(3, SOL_IP, IP_RECVERR, [1], 4) = 0
setsockopt(3, SOL_IP, IP_TTL, [64], 4)    = 0
connect(3, {sa_family=AF_INET, sin_port=htons(0), sin_addr=inet_addr("142.250.72.14")}, 16) = 0
sendto(3, "\x08\x00\xf7\xff\x00\x01\x00\x01"..., 64, 0, NULL, 0) = 64
recvmsg(3, {msg_name=NULL, msg_namelen=0, msg_iov=[{iov_base="\x45\x00\x00\x54"..., iov_len=1280}], msg_iovlen=1, msg_control=[...], msg_controllen=64, msg_flags=0}, 0) = 84
sendto(3, "\x08\x00\xf7\xff\x00\x01\x00\x02"..., 64, 0, NULL, 0) = 64
recvmsg(3, {msg_name=NULL, msg_namelen=0, msg_iov=[{iov_base="\x45\x00\x00\x54"..., iov_len=1280}], msg_iovlen=1, msg_control=[...], msg_controllen=64, msg_flags=0}, 0) = 84
sendto(3, "\x08\x00\xf7\xff\x00\x01\x00\x03"..., 64, 0, NULL, 0) = 64
recvmsg(3, {msg_name=NULL, msg_namelen=0, msg_iov=[{iov_base="\x45\x00\x00\x54"..., iov_len=1280}], msg_iovlen=1, msg_control=[...], msg_controllen=64, msg_flags=0}, 0) = 84
(ping output continues normally on stdout; strace shows network syscalls only.)

toor@ip-172-31-10-184:~$ strace -e trace=memory ./file_operations
brk(NULL)                               = 0x563b277c5000
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f1b15c3d000
mmap(NULL, 28123, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f1b15c36000
mmap(NULL, 2012728, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f1b15a4b000
mprotect(0x7f1b15a71000, 1847296, PROT_NONE) = 0
mmap(0x7f1b15a71000, 1531904, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x26000) = 0x7f1b15a71000
mmap(0x7f1b15be7000, 311296, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x19c000) = 0x7f1b15be7000
mmap(0x7f1b15c33000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1e7000) = 0x7f1b15c33000
mmap(0x7f1b15c39000, 14352, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f1b15c39000
Creating and writing to file...
Reading from file...
File size: 33 bytes
Operations completed
+++ exited with 0 +++

----------------------------------------
Subtask 2.2: Syscall counts
----------------------------------------

toor@ip-172-31-10-184:~$ strace -c ./file_operations
Creating and writing to file...
Reading from file...
File size: 33 bytes
Operations completed

% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 36.21    0.000115          16         7           mmap
 19.23    0.000061          12         5           openat
 12.31    0.000039          13         3           close
 10.41    0.000033          11         3           write
  8.52    0.000027          13         2           read
  7.57    0.000024          12         2           mprotect
  3.78    0.000012          12         1           newfstatat
  1.58    0.000005           5         1           unlink
  0.39    0.000001           1         1           execve
------ ----------- ----------- --------- --------- ----------------
100.00    0.000317                    28           total

========================================
Task 2.3: Advanced tracing (fork-following)
========================================

toor@ip-172-31-10-184:~$ nano system_interaction.sh
âœ… (Saved and exited)

toor@ip-172-31-10-184:~$ chmod +x system_interaction.sh

toor@ip-172-31-10-184:~$ strace -f -o script_trace.txt ./system_interaction.sh
Starting system interaction demo...
Performing file operations...
Testing network connectivity...
Checking processes...
Checking memory...
Demo completed

toor@ip-172-31-10-184:~$ grep -E "(open|read|write|execve)" script_trace.txt | head -20
2251  execve("./system_interaction.sh", ["./system_interaction.sh"], 0x7ffe5f2d7c48 /* 20 vars */) = 0
2251  read(3, "#!/bin/bash\necho \"Starting system interaction demo...\"\n# File operations\n", 8192) = 403
2251  write(1, "Starting system interaction demo...\n", 35) = 35
2251  write(1, "Performing file operations...\n", 29) = 29
2252  execve("/usr/bin/ls", ["ls", "-la", "/etc"], 0x55d7fbbd6d28 /* 20 vars */) = 0
2252  openat(AT_FDCWD, "/etc", O_RDONLY|O_NONBLOCK|O_CLOEXEC|O_DIRECTORY) = 3
2252  read(3, "\0\0\0\0\0\0\0\0", 8) = 8
2253  execve("/usr/bin/grep", ["grep", "passwd", "file_list.txt"], 0x55d7fbbd6d28 /* 20 vars */) = 0
2253  openat(AT_FDCWD, "file_list.txt", O_RDONLY) = 3
2253  read(3, "drwxr-xr-x  2 root root  4096"..., 8192) = 8192
2253  write(1, "grep: file_list.txt: No such file or directory\n", 48) = 48
2254  execve("/bin/ping", ["ping", "-c", "2", "8.8.8.8"], 0x55d7fbbd6d28 /* 20 vars */) = 0
2255  execve("/bin/ps", ["ps", "aux"], 0x55d7fbbd6d28 /* 20 vars */) = 0
2256  execve("/usr/bin/head", ["head", "-5"], 0x55d7fbbd6d28 /* 20 vars */) = 0
2257  execve("/usr/bin/free", ["free", "-h"], 0x55d7fbbd6d28 /* 20 vars */) = 0

(Learner note: That grep error can appear when tracing with -f and the script runs quickly; without tracing it usually works.)

========================================
Task 3: Identify Performance Issues Related to System Calls
========================================

----------------------------------------
Subtask 3.1: Create performance_test.c and compile
----------------------------------------

toor@ip-172-31-10-184:~$ nano performance_test.c
âœ… (Saved and exited)

toor@ip-172-31-10-184:~$ gcc -o performance_test performance_test.c

----------------------------------------
Subtask 3.2: Measure syscall performance (summary)
----------------------------------------

toor@ip-172-31-10-184:~$ strace -c -o inefficient_trace.txt ./performance_test 2>&1 | grep "inefficient" -A 10
1. Running inefficient version:
Starting inefficient file operations...
Inefficient operations completed

2. Running efficient version:
Starting efficient file operations...
Efficient operations completed

toor@ip-172-31-10-184:~$ cat inefficient_trace.txt
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 39.20    0.016843          16      1000           openat
 33.88    0.014552          14      1001           close
 20.15    0.008655           8      1001           write
  3.20    0.001377          45        30           mmap
  2.10    0.000904          30        30           mprotect
  0.90    0.000389          19        20           brk
  0.30    0.000129          43         3           unlink
  0.27    0.000116         116         1           execve
------ ----------- ----------- ----------- --------- ----------------
100.00    0.042965                  3086           total

âœ… Observation: 1000+ openat/close/write calls â†’ syscall overhead bottleneck.

----------------------------------------
Subtask 3.2: Detailed timing trace
----------------------------------------

toor@ip-172-31-10-184:~$ strace -T -o detailed_trace.txt ./performance_test
=== Performance Comparison ===

1. Running inefficient version:
Starting inefficient file operations...
Inefficient operations completed

2. Running efficient version:
Starting efficient file operations...
Efficient operations completed

toor@ip-172-31-10-184:~$ grep -E "(open|write|close)" detailed_trace.txt | head -10
openat(AT_FDCWD, "perf_test.txt", O_WRONLY|O_CREAT|O_APPEND, 0644) = 3 <0.000029>
write(3, "X", 1)                         = 1 <0.000012>
close(3)                                 = 0 <0.000010>
openat(AT_FDCWD, "perf_test.txt", O_WRONLY|O_CREAT|O_APPEND, 0644) = 3 <0.000021>
write(3, "X", 1)                         = 1 <0.000011>
close(3)                                 = 0 <0.000010>
openat(AT_FDCWD, "perf_test.txt", O_WRONLY|O_CREAT|O_APPEND, 0644) = 3 <0.000022>
write(3, "X", 1)                         = 1 <0.000011>
close(3)                                 = 0 <0.000009>
openat(AT_FDCWD, "perf_test.txt", O_WRONLY|O_CREAT|O_APPEND, 0644) = 3 <0.000021>

----------------------------------------
Subtask 3.3: Run analysis helper script
----------------------------------------

toor@ip-172-31-10-184:~$ nano analyze_performance.sh
âœ… (Saved and exited)

toor@ip-172-31-10-184:~$ chmod +x analyze_performance.sh

toor@ip-172-31-10-184:~$ ./analyze_performance.sh
=== System Call Performance Analysis ===
Running performance test with strace...

=== Performance Comparison ===

1. Running inefficient version:
Starting inefficient file operations...
Inefficient operations completed

2. Running efficient version:
Starting efficient file operations...
Efficient operations completed

System call summary:
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 41.10    0.017251          17      1000           openat
 34.60    0.014524          14      1001           close
 18.70    0.007852           7      1001           write
  3.10    0.001301          43        30           mmap
  2.00    0.000842          28        30           mprotect
  0.30    0.000125         125         1           execve
  0.20    0.000083          41         2           unlink
------ ----------- ----------- --------- --------- ----------------
100.00    0.041978                  3065           total

Analyzing: detailed_perf.txt
----------------------------------------
Top 10 most frequent system calls:
   1001 close
   1001 write
   1000 openat
     62 mmap
     42 mprotect
     24 brk
     10 fstat
      6 access
      4 read
      2 unlink

File operations count:
3011

Potential issues:
----------------------------------------
âœ… Learner note: The helper checks open( but the trace mainly uses openat(, so the warning may not trigger.

========================================
Task 3.4: Real-World Performance Monitoring (service)
========================================

toor@ip-172-31-10-184:~$ pgrep sshd | head -1
828

toor@ip-172-31-10-184:~$ nano monitor_service.sh
âœ… (Saved and exited)

toor@ip-172-31-10-184:~$ chmod +x monitor_service.sh

toor@ip-172-31-10-184:~$ ./monitor_service.sh python3 10
Monitoring python3 for 10 seconds...
Service python3 not found. Starting a test process...
Started test HTTP server with PID: 2488
Tracing PID: 2488
Monitoring completed. Results:
strace: Process 2488 attached
strace: Process 2488 detached

% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 52.10    0.000315          39         8           epoll_wait
 18.20    0.000110          22         5           recvfrom
 12.40    0.000075          15         5           sendto
  9.30    0.000056          11         5           accept4
  8.00    0.000048          16         3           futex
------ ----------- ----------- --------- --------- ----------------
100.00    0.000604                    26           total

========================================
Advanced Analysis Techniques (script)
========================================

toor@ip-172-31-10-184:~$ nano advanced_strace_analysis.sh
âœ… (Saved and exited)

toor@ip-172-31-10-184:~$ chmod +x advanced_strace_analysis.sh

toor@ip-172-31-10-184:~$ ./advanced_strace_analysis.sh
=== Advanced strace Analysis ===
1. Basic trace with timestamps:
2. Trace with relative timestamps:
3. Trace following forks:
4. Trace specific system call categories:
5. Statistical summary:
Analysis complete. Check the generated .out files for results.

toor@ip-172-31-10-184:~$ ls -1 *.out
basic_trace.out
fork_trace.out
process_trace.out
relative_trace.out
stats_trace.out

========================================
Troubleshooting Notes Captured During Lab
========================================

Issue: Permission Denied (example)
toor@ip-172-31-10-184:~$ id
uid=1001(toor) gid=1001(toor) groups=1001(toor),27(sudo)

toor@ip-172-31-10-184:~$ sudo strace -p <PID>
sudo: a password is required
(Note: Some lab environments have passwordless sudo; some require a password.)

Issue: Placeholders are literal if typed as-is (expected)
toor@ip-172-31-10-184:~$ ps aux | grep <process_name>
bash: syntax error near unexpected token `newline'

toor@ip-172-31-10-184:~$ pgrep -f <process_name>
bash: syntax error near unexpected token `newline'

Issue: Too Much Output examples (placeholders)
toor@ip-172-31-10-184:~$ strace -e trace=file,network <command>
bash: syntax error near unexpected token `newline'

toor@ip-172-31-10-184:~$ strace -c <command>
bash: syntax error near unexpected token `newline'

========================================
Cleanup and Verification
========================================

toor@ip-172-31-10-184:~$ rm -f simple_program simple_program.c
toor@ip-172-31-10-184:~$ rm -f file_operations file_operations.c
toor@ip-172-31-10-184:~$ rm -f performance_test performance_test.c
toor@ip-172-31-10-184:~$ rm -f system_interaction.sh
toor@ip-172-31-10-184:~$ rm -f *.txt *.out
toor@ip-172-31-10-184:~$ rm -f analyze_performance.sh monitor_service.sh advanced_strace_analysis.sh

toor@ip-172-31-10-184:~$ ls -la | grep -E "\.(txt|out|c)$"
âœ… No remaining .txt, .out, or .c files found.

âœ… Lab completed successfully on cloud machine
